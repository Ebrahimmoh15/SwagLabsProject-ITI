
  name: E2E Scenario Tests
  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main
    schedule:
      - cron: '0 22 * * *'
    workflow_dispatch:


  jobs:
    chrome_linux:
      runs-on: ubuntu-latest
      permissions:
        checks: write
      steps:
        - name: checkout code
          uses: actions/checkout@v5
        - name: locate pom files
          run: |
            echo "Located pom files:"
            find . -maxdepth 6 -name pom.xml || true

        - name: Setup java
          uses: actions/setup-java@v5
          with:
            distribution: 'zulu' # See 'Supported distributions' for available options
            java-version: '21'

        - name: setup maven
          uses: stCarolas/setup-maven@v5
          with:
            maven-version: 3.9.11

        - name: running tests
          run: |
            POM=$(find . -maxdepth 6 -name pom.xml -not -path "*/target/*" | head -n1)
            echo "Located POM: $POM"
            if [ -z "$POM" ]; then
              echo "No pom.xml found" >&2
              exit 1
            fi
            mvn -f "$POM" -Dtest=tests.StandradUser.LoginTest -Dbrowser=chrome -Dheadless=true test
        - name: upload test report
          uses: actions/upload-artifact@v4
          with:
            name: chrome_linux_report
            path: test-output/allure-reports/*.html

    edge_windows:
      runs-on: windows-latest
      permissions:
        checks: write
      steps:
        - name: checkout code
          uses: actions/checkout@v5

        - name: Setup java
          uses: actions/setup-java@v5
          with:
            distribution: 'zulu' # See 'Supported distributions' for available options
            java-version: '21'

        - name: setup maven
          uses: stCarolas/setup-maven@v5
          with:
            maven-version: 3.9.11

        - name: running tests
          shell: pwsh
          run: |
            $pom = Get-ChildItem -Path . -Recurse -Filter pom.xml -File | Where-Object { $_.FullName -notmatch '\\target\\' } | Select-Object -First 1
            if (-not $pom) {
              Write-Error "No pom.xml found"
              exit 1
            }
            Write-Host "Located POM: $($pom.FullName)"
            & mvn -f "$($pom.FullName)" "-Dtest=tests.StandradUser.LoginTest" "-Dbrowser=edge" "-Dheadless=true" clean test
            
        - name: upload test report
          uses: actions/upload-artifact@v4
          with:
            name: edge_windows_report
            path: test-output/allure-reports/*.html
